<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <title>åŸºæœ¬äº‹é …è¦å®šãŠã‚ˆã³ç”Ÿå¾’ä¿è­·è€…è¦å‰‡ | EQAO ã‚¹ã‚¿ãƒƒãƒ•ãƒãƒ¼ã‚¿ãƒ«</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: #f8f9fa;
      min-height: 100vh;
      color: #333;
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .header {
      background: #111;
      padding: 18px 24px;
      display: flex;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .back-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      color: #aaa;
      text-decoration: none;
      font-size: 14px;
      padding: 8px 12px;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .back-btn:hover {
      color: #fff;
      background: rgba(255, 255, 255, 0.1);
    }

    .header-divider {
      width: 1px;
      height: 20px;
      background: #444;
    }

    .header-title {
      font-size: 20px;
      font-weight: 600;
      color: #fff;
    }

    /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 32px 24px 60px;
    }

    /* ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .page-header {
      margin-bottom: 24px;
    }

    .page-icon {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
      background: #fef3c7;
      color: #d97706;
    }

    .page-title {
      font-size: 24px;
      font-weight: 700;
      color: #111;
      margin-bottom: 8px;
    }

    .page-desc {
      font-size: 14px;
      color: #666;
    }

    /* æ³¨æ„æ›¸ããƒãƒŠãƒ¼ */
    .notice-banner {
      background: #fffbeb;
      border: 1px solid #fcd34d;
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 20px;
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }

    .notice-banner .notice-icon {
      color: #d97706;
      flex-shrink: 0;
      margin-top: 2px;
    }

    .notice-content h3 {
      font-size: 14px;
      font-weight: 700;
      color: #92400e;
      margin-bottom: 8px;
    }

    .notice-content p {
      font-size: 13px;
      color: #78350f;
      line-height: 1.7;
    }

    /* æ¤œç´¢ãƒãƒ¼ */
    .search-bar {
      background: white;
      border: 1px solid #e5e5e5;
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .search-bar:focus-within {
      border-color: #f59e0b;
      box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
    }

    .search-bar .search-icon {
      color: #999;
    }

    .search-input {
      flex: 1;
      border: none;
      outline: none;
      font-size: 15px;
      font-family: inherit;
      background: transparent;
    }

    .search-input::placeholder {
      color: #999;
    }

    .search-clear {
      background: none;
      border: none;
      color: #999;
      cursor: pointer;
      padding: 4px;
      display: none;
      border-radius: 50%;
      transition: background 0.2s;
    }

    .search-clear:hover {
      background: #f0f0f0;
    }

    .search-clear.show {
      display: flex;
    }

    /* ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ– */
    .category-tabs {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 12px;
      margin-bottom: 16px;
      -webkit-overflow-scrolling: touch;
    }

    .category-tabs::-webkit-scrollbar {
      display: none;
    }

    .category-tab {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 10px 16px;
      background: white;
      border: 1px solid #e5e5e5;
      border-radius: 25px;
      font-size: 13px;
      font-weight: 500;
      color: #666;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
      font-family: inherit;
    }

    .category-tab:hover {
      border-color: #f59e0b;
      color: #d97706;
    }

    .category-tab.active {
      background: #f59e0b;
      border-color: #f59e0b;
      color: white;
    }

    .tab-number {
      font-size: 12px;
      font-weight: 700;
    }

    /* è¦å®šã‚«ãƒ¼ãƒ‰ */
    .rules-section {
      background: white;
      border: 1px solid #e5e5e5;
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .section-header {
      background: #fef3c7;
      padding: 20px 24px;
      border-bottom: 1px solid #fcd34d;
    }

    .section-title {
      font-size: 17px;
      font-weight: 700;
      color: #92400e;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title .section-icon {
      color: #d97706;
    }

    .section-subtitle {
      font-size: 12px;
      color: #a16207;
      margin-top: 6px;
      padding-left: 34px;
    }

    /* è¦å®šã‚¢ã‚¤ãƒ†ãƒ  */
    .rule-item {
      border-bottom: 1px solid #f0f0f0;
    }

    .rule-item:last-child {
      border-bottom: none;
    }

    .rule-header {
      display: flex;
      align-items: center;
      padding: 16px 24px;
      cursor: pointer;
      transition: background 0.2s;
      gap: 12px;
    }

    .rule-header:hover {
      background: #fefce8;
    }

    .rule-number {
      width: 32px;
      height: 32px;
      background: #f59e0b;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: 700;
      flex-shrink: 0;
    }

    .rule-title-area {
      flex: 1;
      min-width: 0;
    }

    .rule-title {
      font-size: 15px;
      font-weight: 600;
      color: #333;
      line-height: 1.5;
    }

    .rule-updated {
      font-size: 11px;
      color: #999;
      margin-top: 4px;
    }

    .rule-updated.recent {
      color: #dc2626;
      font-weight: 500;
    }

    .rule-toggle {
      color: #ccc;
      transition: transform 0.3s, color 0.2s;
    }

    .rule-header:hover .rule-toggle {
      color: #f59e0b;
    }

    .rule-item.open .rule-toggle {
      transform: rotate(180deg);
      color: #f59e0b;
    }

    .rule-content {
      display: none;
      padding: 0 24px 20px 68px;
    }

    .rule-item.open .rule-content {
      display: block;
    }

    .rule-text {
      font-size: 14px;
      line-height: 1.9;
      color: #444;
    }

    .rule-text p {
      margin-bottom: 12px;
    }

    .rule-text ul {
      margin: 8px 0 12px 20px;
    }

    .rule-text li {
      margin-bottom: 6px;
      line-height: 1.7;
    }

    .rule-text strong {
      color: #d97706;
    }

    /* æ¤œç´¢çµæœ */
    .search-results-info {
      background: #fef3c7;
      border: 1px solid #fcd34d;
      border-radius: 10px;
      padding: 12px 16px;
      margin-bottom: 16px;
      font-size: 14px;
      color: #92400e;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .highlight {
      background: #fde68a;
      padding: 1px 4px;
      border-radius: 3px;
    }

    /* è£œè¶³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .supplement-section {
      background: white;
      border: 1px solid #e5e5e5;
      border-radius: 16px;
      margin-top: 20px;
      overflow: hidden;
    }

    .supplement-header {
      background: #374151;
      padding: 16px 24px;
      color: white;
    }

    .supplement-title {
      font-size: 15px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .supplement-content {
      padding: 20px 24px;
    }

    .supplement-item {
      margin-bottom: 20px;
    }

    .supplement-item:last-child {
      margin-bottom: 0;
    }

    .supplement-item h4 {
      font-size: 14px;
      font-weight: 700;
      color: #374151;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .supplement-item h4 .sup-icon {
      color: #6b7280;
    }

    .supplement-item p {
      font-size: 13px;
      line-height: 1.8;
      color: #555;
    }

    /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
    .loading {
      text-align: center;
      padding: 60px 20px;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #fef3c7;
      border-top-color: #f59e0b;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .loading-text {
      color: #666;
      font-size: 14px;
    }

    /* ã‚¨ãƒ©ãƒ¼ */
    .error-message {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 12px;
      padding: 24px;
      text-align: center;
      color: #dc2626;
    }

    .error-message .error-icon {
      margin-bottom: 12px;
      color: #dc2626;
    }

    .error-message .retry-btn {
      margin-top: 16px;
      padding: 10px 24px;
      background: #f59e0b;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      font-family: inherit;
      transition: background 0.2s;
    }

    .error-message .retry-btn:hover {
      background: #d97706;
    }

    /* ç©ºçŠ¶æ…‹ */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-state .empty-icon {
      margin-bottom: 12px;
      opacity: 0.5;
    }

    /* ãƒ•ãƒƒã‚¿ãƒ¼ */
    .footer {
      text-align: center;
      padding: 32px 24px;
      margin-top: 20px;
    }

    .footer-text {
      font-size: 13px;
      color: #999;
    }

    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
    @media (max-width: 768px) {
      .header {
        padding: 14px 16px;
      }

      .header-title {
        font-size: 14px;
      }

      .container {
        padding: 24px 16px 40px;
      }

      .page-header {
        margin-bottom: 20px;
      }

      .page-title {
        font-size: 20px;
      }

      .section-header {
        padding: 16px;
      }

      .section-title {
        font-size: 15px;
      }

      .rule-header {
        padding: 14px 16px;
      }

      .rule-content {
        padding: 0 16px 16px 52px;
      }

      .rule-number {
        width: 28px;
        height: 28px;
        font-size: 12px;
      }

      .rule-title {
        font-size: 14px;
      }

      .category-tab {
        padding: 8px 12px;
        font-size: 12px;
      }

      .supplement-content {
        padding: 16px;
      }
    }
  </style>
</head>

<body>
  <header class="header">
    <div class="header-content">
      <div class="header-left">
        <a href="category-rules.html" class="back-btn">
          <i data-lucide="arrow-left" style="width:16px;height:16px;"></i>
          æˆ»ã‚‹
        </a>
        <div class="header-divider"></div>
        <span class="header-title">åŸºæœ¬äº‹é …è¦å®šæ›¸</span>
      </div>
    </div>
  </header>

  <div class="container">
    <!-- ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="page-header">
      <div class="page-icon">
        <i data-lucide="file-text" style="width:28px;height:28px;"></i>
      </div>
      <h1 class="page-title">åŸºæœ¬äº‹é …è¦å®šãŠã‚ˆã³ç”Ÿå¾’ä¿è­·è€…è¦å‰‡</h1>
      <p class="page-desc">ç”Ÿå¾’ãƒ»ä¿è­·è€…å‘ã‘ã®åŸºæœ¬ãƒ«ãƒ¼ãƒ«ã¨è¦å®šã‚’ç¢ºèªã§ãã¾ã™</p>
    </div>

    <!-- æ³¨æ„æ›¸ããƒãƒŠãƒ¼ -->
    <div class="notice-banner">
      <i data-lucide="alert-circle" class="notice-icon" style="width:22px;height:22px;"></i>
      <div class="notice-content">
        <h3>ã‚¹ã‚¿ãƒƒãƒ•å‘ã‘ç¢ºèªäº‹é …</h3>
        <p>
          ã“ã®è¦å®šã¯ç”Ÿå¾’ãƒ»ä¿è­·è€…ã«é©ç”¨ã•ã‚Œã‚‹ãƒ«ãƒ¼ãƒ«ã§ã™ã€‚ä¿è­·è€…å¯¾å¿œã‚„å•ã„åˆã‚ã›æ™‚ã®å‚ç…§ç”¨ã¨ã—ã¦ã”æ´»ç”¨ãã ã•ã„ã€‚<br>
          è¦å®šå†…å®¹ã¯éšæ™‚æ›´æ–°ã•ã‚Œã¾ã™ã€‚ç”Ÿå¾’ãƒ»ä¿è­·è€…ã‹ã‚‰è³ªå•ãŒã‚ã£ãŸéš›ã¯ã€æœ€æ–°ã®å†…å®¹ã‚’ã”ç¢ºèªã®ä¸Šã”æ¡ˆå†…ãã ã•ã„ã€‚
        </p>
      </div>
    </div>

    <!-- æ¤œç´¢ãƒãƒ¼ -->
    <div class="search-bar">
      <i data-lucide="search" class="search-icon" style="width:20px;height:20px;"></i>
      <input type="text" class="search-input" id="searchInput" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢...">
      <button class="search-clear" id="searchClear" onclick="clearSearch()">
        <i data-lucide="x" style="width:18px;height:18px;"></i>
      </button>
    </div>

    <!-- ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ– -->
    <div class="category-tabs" id="categoryTabs">
      <!-- JSã§ç”Ÿæˆ -->
    </div>

    <!-- æ¤œç´¢çµæœæƒ…å ± -->
    <div class="search-results-info" id="searchResultsInfo" style="display: none;">
      <i data-lucide="search" style="width:18px;height:18px;"></i>
      <span id="searchResultsText"></span>
    </div>

    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
    <div id="loading" class="loading">
      <div class="loading-spinner"></div>
      <p class="loading-text">è¦å®šã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
    </div>

    <!-- è¦å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div id="rulesContainer"></div>

    <!-- è£œè¶³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="supplement-section" id="supplementSection" style="display: none;">
      <div class="supplement-header">
        <h3 class="supplement-title">
          <i data-lucide="clipboard-list" style="width:20px;height:20px;"></i>
          åŸºæœ¬äº‹é …è¦å®šãŠã‚ˆã³ç”Ÿå¾’ãƒ»ä¿è­·è€…è¦å‰‡ã®å–æ‰±ã„ã«ã¤ã„ã¦
        </h3>
      </div>
      <div class="supplement-content">
        <div class="supplement-item">
          <h4><i data-lucide="file-text" class="sup-icon" style="width:16px;height:16px;"></i>è¦å‰‡ã®è¨˜è¼‰å ´æ‰€ã«ã¤ã„ã¦</h4>
          <p>
            æœ¬æ ¡ã«ãŠã‘ã‚‹åŸºæœ¬äº‹é …è¦å®šãŠã‚ˆã³ç”Ÿå¾’ãƒ»ä¿è­·è€…è¦å‰‡ã¯ã€EQAOãƒãƒ¼ã‚¿ãƒ«å†…ã«ä»˜å±ã™ã‚‹å„ç¨®ãƒœã‚¿ãƒ³ãƒ»ç”³è«‹ãƒšãƒ¼ã‚¸ãƒ»ç”³è¾¼ãƒšãƒ¼ã‚¸ç­‰ã«ãŠã„ã¦ã€è©²å½“ã™ã‚‹æ‰‹ç¶šãå†…å®¹ã”ã¨ã«åˆ†æ•£ã—ã¦è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
            ã“ã‚Œã¯ã€ç”Ÿå¾’ãŠã‚ˆã³ä¿è­·è€…ã®çš†æ§˜ãŒå®Ÿéš›ã«ç”³è«‹ãƒ»å¥‘ç´„ãƒ»ç”³è¾¼ãƒ»å¤‰æ›´ç­‰ã‚’è¡Œã†ãã®éƒ½åº¦ã€é–¢é€£ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã‚’å†èªè­˜ã—ã‚„ã™ãã™ã‚‹ã“ã¨ã€ãªã‚‰ã³ã«å®Ÿç”¨æ€§ãƒ»åˆ©ä¾¿æ€§ã‚’é«˜ã‚ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ãŸé‹ç”¨ã§ã™ã€‚
          </p>
        </div>
        <div class="supplement-item">
          <h4><i data-lucide="refresh-cw" class="sup-icon" style="width:16px;height:16px;"></i>è¦å‰‡ã®å¤‰æ›´ãƒ»æ›´æ–°ã«ã¤ã„ã¦</h4>
          <p>
            åŸºæœ¬äº‹é …è¦å®šãŠã‚ˆã³ç”Ÿå¾’ãƒ»ä¿è­·è€…è¦å‰‡ã¯ã€é‹å–¶ä¸Šã®å¿…è¦æ€§ã€å®Ÿéš›ã®é‹ç”¨çŠ¶æ³ã€éå»ã®ãƒˆãƒ©ãƒ–ãƒ«ãƒ»ãŠå•ã„åˆã‚ã›ãƒ»ã‚¯ãƒ¬ãƒ¼ãƒ ç­‰ã‚’è¸ã¾ãˆã€éšæ™‚ã€å¤‰æ›´ãƒ»æ›´æ–°ãƒ»è¿½åŠ ãŒè¡Œã‚ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
            ã“ã‚Œã‚‰ã®å¤‰æ›´ã¯ã€ã‚ˆã‚Šè‰¯ã„æ•™è‚²ã‚µãƒ¼ãƒ“ã‚¹ã®æä¾›ã€åˆ©ç”¨è€…ã®ä¸åˆ©ç›Šã‚’é˜²ããŸã‚ã®äºˆé˜²çš„æªç½®ã€é‹å–¶ã®å††æ»‘åŒ–ãŠã‚ˆã³å“è³ªå‘ä¸Šã‚’ç›®çš„ã¨ã—ãŸåˆç†çš„ã‹ã¤å¿…è¦ãªç¯„å›²ã§å®Ÿæ–½ã•ã‚Œã¾ã™ã€‚
          </p>
        </div>
        <div class="supplement-item">
          <h4><i data-lucide="scale" class="sup-icon" style="width:16px;height:16px;"></i>ãƒ•ã‚©ãƒ¼ãƒ ãƒ»å„ãƒšãƒ¼ã‚¸ã«è¨˜è¼‰ã•ã‚ŒãŸè¦å‰‡ã®åŠ¹åŠ›ã«ã¤ã„ã¦</h4>
          <p>
            å„ç¨®ç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ ã€å¤‰æ›´ãƒ•ã‚©ãƒ¼ãƒ ã€ãƒãƒ¼ã‚¿ãƒ«å†…ãƒšãƒ¼ã‚¸ã€ãªã‚‰ã³ã«å…¬å¼ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆä¸Šã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹æ³¨æ„äº‹é …ãƒ»è¦å‰‡ãƒ»æ¡ä»¶ç­‰ã¯ã€æœ¬åŸºæœ¬äº‹é …è¦å®šãŠã‚ˆã³ç”Ÿå¾’ãƒ»ä¿è­·è€…è¦å‰‡ã¨åŒç­‰ã®åŠ¹åŠ›ã‚’æœ‰ã™ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚
            æœ¬æ›¸é¡ã«æ˜ç¤ºçš„ã«è¨˜è¼‰ã•ã‚Œã¦ã„ãªã„äº‹é …ã§ã‚ã£ã¦ã‚‚ã€ãƒãƒ¼ã‚¿ãƒ«ãƒ»ãƒ•ã‚©ãƒ¼ãƒ ãƒ»å„ãƒšãƒ¼ã‚¸ç­‰ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹å†…å®¹ã«ã¤ã„ã¦ã¯ã€æ­£å¼ãªè¦å‰‡ãƒ»æ³¨æ„äº‹é …ã¨ã—ã¦é©ç”¨ã•ã‚Œã¾ã™ã€‚
          </p>
        </div>
      </div>
    </div>
  </div>

  <footer class="footer">
    <p class="footer-text">Â© 2026 EQAO Education Group</p>
  </footer>

  <script>
    // ========================================
    // è¨­å®š
    // ========================================
    // â†“ æ—¢å­˜ã®GAS Webã‚¢ãƒ—ãƒªURLã‚’è¨­å®šã—ã¦ãã ã•ã„
    const API_URL = 'https://script.google.com/macros/s/AKfycbyXdCxzPU6oXAm2Mi9mfMDeNvQAyE0mmTOABA2EOYelvX6J2Rr48VcizS0vMgIS7Qc7/exec';

    // ========================================
    // çŠ¶æ…‹ç®¡ç†
    // ========================================
    let allCategories = [];
    let allRules = [];
    let currentCategory = 'all';
    let searchQuery = '';
    let searchTimeout = null;

    // ã‚«ãƒ†ã‚´ãƒªã‚¢ã‚¤ã‚³ãƒ³ãƒãƒƒãƒ”ãƒ³ã‚°
    const categoryIcons = {
      1: 'book-open',
      2: 'clock',
      3: 'credit-card',
      4: 'calendar-x',
      5: 'user-x',
      6: 'alert-triangle',
      7: 'shield',
      8: 'mail',
      9: 'settings',
      10: 'file-text'
    };

    // ========================================
    // åˆæœŸåŒ–
    // ========================================
    document.addEventListener('DOMContentLoaded', function () {
      loadRules();
      setupSearch();
      lucide.createIcons();
    });

    // ========================================
    // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    // ========================================
    async function loadRules() {
      try {
        const response = await fetch(`${API_URL}?action=getBasicRules`);
        const data = await response.json();

        if (data.success) {
          allCategories = data.categories;
          allRules = data.rules;

          renderCategoryTabs();
          renderRules();

          document.getElementById('loading').style.display = 'none';
          document.getElementById('supplementSection').style.display = 'block';
        } else {
          showError('ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      } catch (error) {
        console.error('Error:', error);
        showError('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    }

    // ========================================
    // ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–
    // ========================================
    function renderCategoryTabs() {
      const container = document.getElementById('categoryTabs');

      let html = `
        <button class="category-tab active" onclick="selectCategory('all')">
          <i data-lucide="layers" style="width:16px;height:16px;"></i>
          <span>ã™ã¹ã¦</span>
        </button>
      `;

      allCategories.forEach(cat => {
        html += `
          <button class="category-tab" onclick="selectCategory(${cat.number})">
            <span class="tab-number">${getCircledNumber(cat.number)}</span>
            <span>${cat.name.replace(/ã«é–¢ã™ã‚‹è¦å®š$/, '')}</span>
          </button>
        `;
      });

      container.innerHTML = html;
      lucide.createIcons();
    }

    function getCircledNumber(num) {
      const numbers = ['', 'â‘ ', 'â‘¡', 'â‘¢', 'â‘£', 'â‘¤', 'â‘¥', 'â‘¦', 'â‘§', 'â‘¨', 'â‘©'];
      return numbers[num] || num;
    }

    function selectCategory(category) {
      currentCategory = category;

      // ã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹æ›´æ–°
      document.querySelectorAll('.category-tab').forEach((tab, index) => {
        if (category === 'all' && index === 0) {
          tab.classList.add('active');
        } else if (category === allCategories[index - 1]?.number) {
          tab.classList.add('active');
        } else {
          tab.classList.remove('active');
        }
      });

      renderRules();
    }

    // ========================================
    // è¦å®šè¡¨ç¤º
    // ========================================
    function renderRules() {
      const container = document.getElementById('rulesContainer');

      // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
      let filteredRules = allRules;

      if (currentCategory !== 'all') {
        filteredRules = filteredRules.filter(r => r.categoryNumber === currentCategory);
      }

      if (searchQuery) {
        const terms = searchQuery.toLowerCase().split(/\s+/);
        filteredRules = filteredRules.filter(r => {
          const text = (r.title + ' ' + r.content).toLowerCase();
          return terms.every(term => text.includes(term));
        });

        // æ¤œç´¢çµæœæƒ…å ±ã‚’è¡¨ç¤º
        document.getElementById('searchResultsInfo').style.display = 'flex';
        document.getElementById('searchResultsText').textContent =
          `ã€Œ${searchQuery}ã€ã®æ¤œç´¢çµæœ: ${filteredRules.length}ä»¶`;
      } else {
        document.getElementById('searchResultsInfo').style.display = 'none';
      }

      if (filteredRules.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <i data-lucide="search-x" class="empty-icon" style="width:48px;height:48px;"></i>
            <p>è©²å½“ã™ã‚‹è¦å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>
          </div>
        `;
        lucide.createIcons();
        return;
      }

      // ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
      const grouped = {};
      filteredRules.forEach(rule => {
        if (!grouped[rule.categoryNumber]) {
          grouped[rule.categoryNumber] = [];
        }
        grouped[rule.categoryNumber].push(rule);
      });

      let html = '';

      Object.keys(grouped).sort((a, b) => a - b).forEach(catNum => {
        const category = allCategories.find(c => c.number == catNum);
        const rules = grouped[catNum];
        const iconName = categoryIcons[catNum] || 'file-text';

        html += `
          <div class="rules-section">
            <div class="section-header">
              <h2 class="section-title">
                <i data-lucide="${iconName}" class="section-icon" style="width:22px;height:22px;"></i>
                ${getCircledNumber(parseInt(catNum))} ${category?.name || ''}
              </h2>
              <p class="section-subtitle">${rules.length}ä»¶ã®è¦å®š</p>
            </div>
        `;

        rules.forEach(rule => {
          const isRecent = isRecentUpdate(rule.updatedAt);
          const content = formatContent(rule.content, searchQuery);
          const title = highlightText(rule.title, searchQuery);

          html += `
            <div class="rule-item" onclick="toggleRule(this)">
              <div class="rule-header">
                <div class="rule-number">${rule.itemNumber}</div>
                <div class="rule-title-area">
                  <div class="rule-title">${title}</div>
                  ${rule.updatedAt ? `<div class="rule-updated ${isRecent ? 'recent' : ''}">
                    ${isRecent ? 'ğŸ†• ' : ''}æ›´æ–°æ—¥: ${rule.updatedAt}
                  </div>` : ''}
                </div>
                <i data-lucide="chevron-down" class="rule-toggle" style="width:20px;height:20px;"></i>
              </div>
              <div class="rule-content">
                <div class="rule-text">${content}</div>
              </div>
            </div>
          `;
        });

        html += '</div>';
      });

      container.innerHTML = html;
      lucide.createIcons();
    }

    function toggleRule(element) {
      element.classList.toggle('open');
    }

    function isRecentUpdate(dateStr) {
      if (!dateStr) return false;
      const date = new Date(dateStr.replace(/\//g, '-'));
      const now = new Date();
      const diff = (now - date) / (1000 * 60 * 60 * 24);
      return diff <= 7;
    }

    function formatContent(content, query) {
      if (!content) return '';

      // æ”¹è¡Œã§åˆ†å‰²ã—ã¦å‡¦ç†
      let html = content
        .split('\n')
        .map(line => {
          line = line.trim();
          if (!line) return '';

          // ç®‡æ¡æ›¸ãï¼ˆãƒ»ã‚„-ã§å§‹ã¾ã‚‹è¡Œï¼‰
          if (line.match(/^[ãƒ»\-â€¢]/)) {
            return `<li>${escapeHtml(line.replace(/^[ãƒ»\-â€¢]\s*/, ''))}</li>`;
          }
          return `<p>${escapeHtml(line)}</p>`;
        })
        .join('');

      // <li>ãŒé€£ç¶šã—ã¦ã„ã‚‹éƒ¨åˆ†ã‚’<ul>ã§å›²ã‚€
      html = html.replace(/(<li>.*?<\/li>)+/g, '<ul>$&</ul>');

      // æ¤œç´¢ãƒã‚¤ãƒ©ã‚¤ãƒˆ
      if (query) {
        const terms = query.split(/\s+/);
        terms.forEach(term => {
          if (term) {
            const regex = new RegExp(`(${escapeRegex(term)})`, 'gi');
            html = html.replace(regex, '<span class="highlight">$1</span>');
          }
        });
      }

      return html;
    }

    function highlightText(text, query) {
      if (!query || !text) return escapeHtml(text);

      let result = escapeHtml(text);
      const terms = query.split(/\s+/);
      terms.forEach(term => {
        if (term) {
          const regex = new RegExp(`(${escapeRegex(term)})`, 'gi');
          result = result.replace(regex, '<span class="highlight">$1</span>');
        }
      });
      return result;
    }

    // ========================================
    // æ¤œç´¢
    // ========================================
    function setupSearch() {
      const input = document.getElementById('searchInput');
      const clearBtn = document.getElementById('searchClear');

      input.addEventListener('input', function () {
        clearBtn.classList.toggle('show', this.value.length > 0);

        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          searchQuery = this.value.trim();
          renderRules();
        }, 300);
      });
    }

    function clearSearch() {
      document.getElementById('searchInput').value = '';
      document.getElementById('searchClear').classList.remove('show');
      searchQuery = '';
      renderRules();
    }

    // ========================================
    // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    // ========================================
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function escapeRegex(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    function showError(message) {
      document.getElementById('loading').innerHTML = `
        <div class="error-message">
          <i data-lucide="alert-circle" class="error-icon" style="width:40px;height:40px;"></i>
          <p>${message}</p>
          <button onclick="location.reload()" class="retry-btn">å†èª­ã¿è¾¼ã¿</button>
        </div>
      `;
      lucide.createIcons();
    }
  </script>
</body>

</html>