<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EQAO PORTAL for staff</title>
  <link rel="apple-touch-icon" sizes="180x180" href="/staff_logo.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/staff_logo.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/staff_logo.png">
  <link rel="icon" type="image/png" href="/staff_logo.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: #f8f9fa;
      min-height: 100vh;
      color: #333;
    }

    /* ヘッダー */
    .header {
      background: #111;
      padding: 18px 24px;
      display: flex;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo-area {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo {
      width: 60px;
      height: 60px;
    }

    .logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 8px;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .brand-name {
      font-size: 34px;
      font-weight: 700;
      color: #fff;
      letter-spacing: 0px;
    }

    .header-nav {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      color: #aaa;
      text-decoration: none;
      font-size: 14px;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .nav-item:hover {
      color: #fff;
      background: rgba(255, 255, 255, 0.1);
    }

    /* ユーザーメニュー */
    .user-menu {
      position: relative;
    }

    .user-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 8px;
      color: #fff;
      font-size: 13px;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s;
    }

    .user-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .user-avatar {
      width: 28px;
      height: 28px;
      background: #10b981;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
    }

    .user-name {
      max-width: 120px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .user-dropdown {
      position: absolute;
      top: calc(100% + 8px);
      right: 0;
      background: #fff;
      border: 1px solid #e5e5e5;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
      min-width: 200px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.2s;
      z-index: 200;
    }

    .user-dropdown.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .dropdown-header {
      padding: 14px 16px;
      border-bottom: 1px solid #f0f0f0;
    }

    .dropdown-name {
      font-size: 14px;
      font-weight: 600;
      color: #111;
      margin-bottom: 2px;
    }

    .dropdown-email {
      font-size: 12px;
      color: #888;
    }

    .dropdown-menu {
      padding: 8px;
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 8px;
      font-size: 13px;
      color: #555;
      text-decoration: none;
      transition: all 0.2s;
      cursor: pointer;
      border: none;
      background: none;
      width: 100%;
      font-family: inherit;
    }

    .dropdown-item:hover {
      background: #f5f5f5;
      color: #111;
    }

    .dropdown-item.danger {
      color: #ef4444;
    }

    .dropdown-item.danger:hover {
      background: #fef2f2;
    }

    .dropdown-divider {
      height: 1px;
      background: #f0f0f0;
      margin: 4px 8px;
    }

    /* メイン */
    .main {
      max-width: 1000px;
      margin: 0 auto;
      padding: 40px 24px;
    }

    /* お知らせ掲示板 */
    .notice-board {
      background: #fff;
      border: 1px solid #e5e5e5;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
    }

    .notice-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #f0f0f0;
    }

    .notice-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 15px;
      font-weight: 700;
      color: #111;
    }

    .notice-all {
      font-size: 13px;
      color: #888;
      text-decoration: none;
      transition: color 0.2s;
    }

    .notice-all:hover {
      color: #111;
    }

    .notice-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .notice-empty {
      text-align: center;
      padding: 24px 16px;
      color: #999;
      font-size: 14px;
    }

    .notice-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      background: #f9fafb;
      border-radius: 10px;
      text-decoration: none;
      color: inherit;
      transition: all 0.2s;
    }

    .notice-item:hover {
      background: #f0f0f0;
    }

    .notice-item.new {
      background: #fef3c7;
    }

    .notice-item.new:hover {
      background: #fde68a;
    }

    .notice-badge {
      flex-shrink: 0;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 700;
      background: #ef4444;
      color: #fff;
    }

    .notice-badge.info {
      background: #6b7280;
    }

    .notice-text {
      flex: 1;
      font-size: 13px;
      color: #333;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .notice-date {
      flex-shrink: 0;
      font-size: 12px;
      color: #999;
    }

    /* クイックアクション */
    .quick-actions {
      margin-bottom: 40px;
      padding: 20px;
      background: #fff;
      border-radius: 16px;
      border: 1px solid #e5e5e5;
    }

    .quick-header {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      font-weight: 700;
      color: #888;
      margin-bottom: 14px;
    }

    .quick-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .quick-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 18px;
      background: #10b981;
      border-radius: 10px;
      color: #fff;
      font-size: 14px;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.2s;
    }

    .quick-btn:hover {
      background: #059669;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .quick-btn.secondary {
      background: #f3f4f6;
      color: #374151;
    }

    .quick-btn.secondary:hover {
      background: #e5e7eb;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .quick-btn.highlight {
      background: #5b21b6;
    }

    .quick-btn.highlight:hover {
      background: #4c1d95;
      box-shadow: 0 4px 12px rgba(91, 33, 182, 0.35);
    }

    /* カテゴリグリッド */
    .category-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin-bottom: 32px;
    }

    /* カテゴリカード */
    .category-card {
      background: #fff;
      border: 1px solid #e5e5e5;
      border-radius: 16px;
      padding: 24px;
      transition: all 0.2s ease;
      cursor: pointer;
      text-decoration: none;
      color: inherit;
      display: block;
      position: relative;
      overflow: hidden;
    }

    .category-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
    }

    .category-card.blue::before {
      background: #0ea5e9;
    }

    .category-card.green::before {
      background: #10b981;
    }

    .category-card.purple::before {
      background: #8b5cf6;
    }

    .category-card.orange::before {
      background: #f59e0b;
    }

    .category-card.pink::before {
      background: #ec4899;
    }

    .category-card.teal::before {
      background: #14b8a6;
    }

    .category-card:hover {
      border-color: #ccc;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      transform: translateY(-3px);
    }

    .card-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .card-icon {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .category-card.blue .card-icon {
      background: #e0f2fe;
      color: #0ea5e9;
    }

    .category-card.green .card-icon {
      background: #d1fae5;
      color: #10b981;
    }

    .category-card.purple .card-icon {
      background: #ede9fe;
      color: #8b5cf6;
    }

    .category-card.orange .card-icon {
      background: #fef3c7;
      color: #f59e0b;
    }

    .category-card.pink .card-icon {
      background: #fce7f3;
      color: #ec4899;
    }

    .category-card.teal .card-icon {
      background: #ccfbf1;
      color: #14b8a6;
    }

    .card-arrow {
      color: #ccc;
      transition: all 0.2s;
    }

    .category-card:hover .card-arrow {
      color: #666;
      transform: translateX(4px);
    }

    .card-title {
      font-size: 16px;
      font-weight: 700;
      color: #111;
      margin-bottom: 6px;
    }

    .card-desc {
      font-size: 13px;
      color: #666;
      margin-bottom: 12px;
    }

    .card-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .card-tag {
      font-size: 11px;
      padding: 4px 8px;
      background: #f3f4f6;
      color: #6b7280;
      border-radius: 4px;
    }

    /* 幹部エリア */
    .executive-section {
      background: #fff;
      border: 2px solid #111;
      border-radius: 16px;
      padding: 28px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
    }

    .executive-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .executive-icon {
      width: 52px;
      height: 52px;
      background: #111;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      flex-shrink: 0;
    }

    .executive-info h2 {
      font-size: 18px;
      font-weight: 700;
      color: #111;
      margin-bottom: 4px;
    }

    .executive-info p {
      font-size: 13px;
      color: #666;
    }

    .executive-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #111;
      color: #fff;
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .executive-btn:hover {
      background: #333;
      transform: translateY(-2px);
    }

    /* フッター */
    .footer {
      text-align: center;
      padding: 32px 24px;
      margin-top: 20px;
    }

    .footer-text {
      font-size: 13px;
      color: #999;
    }

    /* レスポンシブ */
    @media (max-width: 768px) {
      .header {
        padding: 12px 16px;
      }

      .logo {
        width: 40px;
        height: 40px;
      }

      .brand-name {
        font-size: 18px;
      }

      .logo-area {
        gap: 10px;
      }

      .main {
        padding: 24px 16px;
      }

      .category-grid {
        grid-template-columns: 1fr;
      }

      .quick-actions {
        padding: 16px;
      }

      .quick-btn {
        padding: 10px 14px;
        font-size: 13px;
      }

      .notice-item {
        padding: 10px 12px;
      }

      .notice-text {
        font-size: 12px;
      }

      .executive-section {
        flex-direction: column;
        text-align: center;
      }

      .executive-left {
        flex-direction: column;
      }

      .user-name {
        display: none;
      }

      .user-btn {
        padding: 6px 8px;
      }
    }

    /* パスワード変更モーダル */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-container {
      background: #fff;
      border-radius: 16px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid #e5e5e5;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 700;
      color: #111;
      margin: 0;
    }

    .modal-close {
      background: none;
      border: none;
      color: #888;
      cursor: pointer;
      padding: 4px;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .modal-close:hover {
      background: #f5f5f5;
      color: #111;
    }

    .modal-body {
      padding: 24px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: #555;
      margin-bottom: 6px;
    }

    .form-input {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.2s;
      box-sizing: border-box;
    }

    .form-input:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .error-message {
      color: #ef4444;
      font-size: 13px;
      margin-top: 8px;
    }

    .modal-footer {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      padding: 16px 24px;
      border-top: 1px solid #e5e5e5;
    }

    .btn-cancel {
      padding: 10px 20px;
      border: 1px solid #ddd;
      background: #fff;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      color: #555;
      cursor: pointer;
      font-family: inherit;
      transition: all 0.2s;
    }

    .btn-cancel:hover {
      background: #f5f5f5;
    }

    .btn-primary {
      padding: 10px 20px;
      border: none;
      background: #6366f1;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      color: #fff;
      cursor: pointer;
      font-family: inherit;
      transition: all 0.2s;
    }

    .btn-primary:hover {
      background: #4f46e5;
    }

    .btn-primary:disabled {
      background: #c7c7c7;
      cursor: not-allowed;
    }
  </style>
</head>

<body>
  <!-- ヘッダー -->
  <header class="header">
    <div class="header-content">
      <div class="logo-area">
        <div class="logo">
          <img src="staff_logo.png" alt="EQAO STAFF">
        </div>
        <div class="brand-name">EQAO PORTAL　for staff</div>
      </div>
      <nav class="header-nav">
        <!-- ユーザーメニュー -->
        <div class="user-menu">
          <button class="user-btn" id="userBtn" onclick="toggleUserMenu()">
            <div class="user-avatar" id="userAvatar">-</div>
            <span class="user-name" id="userName">ログイン中</span>
            <i data-lucide="chevron-down" style="width:16px;height:16px;"></i>
          </button>
          <div class="user-dropdown" id="userDropdown">
            <div class="dropdown-header">
              <div class="dropdown-name" id="dropdownName">-</div>
              <div class="dropdown-email" id="dropdownEmail">-</div>
            </div>
            <div class="dropdown-menu">
              <a href="my-schedule.html" class="dropdown-item">
                <i data-lucide="calendar" style="width:16px;height:16px;"></i>
                マイスケジュール
              </a>
              <button class="dropdown-item" onclick="openPasswordModal()">
                <i data-lucide="key" style="width:16px;height:16px;"></i>
                パスワード変更
              </button>
              <div class="dropdown-divider"></div>
              <button class="dropdown-item danger" onclick="handleLogout()">
                <i data-lucide="log-out" style="width:16px;height:16px;"></i>
                ログアウト
              </button>
            </div>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <!-- メイン -->
  <main class="main">
    <!-- お知らせ掲示板 -->
    <div class="notice-board">
      <div class="notice-header">
        <div class="notice-title">
          <i data-lucide="megaphone" style="width:20px;height:20px;"></i>
          お知らせ
        </div>
        <a href="#" class="notice-all">すべて見る</a>
      </div>
      <div class="notice-list">
        <div class="notice-empty">
          <p>現在、お知らせはありません</p>
        </div>
      </div>
    </div>

    <!-- クイックアクション -->
    <div class="quick-actions">
      <div class="quick-header">
        <i data-lucide="zap" style="width:16px;height:16px;"></i>
        クイックメニュー
      </div>
      <div class="quick-buttons">
        <a href="lesson-dashboard.html" class="quick-btn highlight">
          <i data-lucide="layout-dashboard" style="width:18px;height:18px;"></i>
          授業ダッシュボード
        </a>
        <a href="my-schedule.html" class="quick-btn">
          <i data-lucide="calendar-check" style="width:18px;height:18px;"></i>
          各自のスケジュール
        </a>
        <a href="staff-students.html" class="quick-btn">
          <i data-lucide="users" style="width:18px;height:18px;"></i>
          生徒保護者一覧
        </a>
      </div>
    </div>

    <!-- カテゴリグリッド -->
    <div class="category-grid">
      <!-- スケジュール -->
      <a href="category-schedule.html" class="category-card blue">
        <div class="card-header">
          <div class="card-icon">
            <i data-lucide="calendar" style="width:24px;height:24px;"></i>
          </div>
          <div class="card-arrow">
            <i data-lucide="arrow-right" style="width:16px;height:16px;"></i>
          </div>
        </div>
        <div class="card-title">スケジュール</div>
        <div class="card-desc">授業予定・年間スケジュール・振替状況など</div>
        <div class="card-tags">
          <span class="card-tag">個人予定</span>
          <span class="card-tag">年間予定</span>
          <span class="card-tag">講師稼働</span>
        </div>
      </a>

      <!-- 生徒管理 -->
      <a href="category-students.html" class="category-card green">
        <div class="card-header">
          <div class="card-icon">
            <i data-lucide="graduation-cap" style="width:24px;height:24px;"></i>
          </div>
          <div class="card-arrow">
            <i data-lucide="arrow-right" style="width:16px;height:16px;"></i>
          </div>
        </div>
        <div class="card-title">生徒管理</div>
        <div class="card-desc">生徒情報・担任一覧・進捗状況など</div>
        <div class="card-tags">
          <span class="card-tag">生徒ポータル</span>
          <span class="card-tag">担任・メンター</span>
          <span class="card-tag">自習室</span>
        </div>
      </a>

      <!-- 授業・教材 -->
      <a href="category-lessons.html" class="category-card purple">
        <div class="card-header">
          <div class="card-icon">
            <i data-lucide="book-open" style="width:24px;height:24px;"></i>
          </div>
          <div class="card-arrow">
            <i data-lucide="arrow-right" style="width:16px;height:16px;"></i>
          </div>
        </div>
        <div class="card-title">授業・教材</div>
        <div class="card-desc">授業ダッシュボード・教材・過去問など</div>
        <div class="card-tags">
          <span class="card-tag">授業ダッシュボード</span>
          <span class="card-tag">動画教材</span>
          <span class="card-tag">過去問</span>
        </div>
      </a>

      <!-- ルール・研修 -->
      <a href="category-rules.html" class="category-card orange">
        <div class="card-header">
          <div class="card-icon">
            <i data-lucide="book" style="width:24px;height:24px;"></i>
          </div>
          <div class="card-arrow">
            <i data-lucide="arrow-right" style="width:16px;height:16px;"></i>
          </div>
        </div>
        <div class="card-title">ルール・研修</div>
        <div class="card-desc">スタッフルール・マニュアル・研修など</div>
        <div class="card-tags">
          <span class="card-tag">規定書</span>
          <span class="card-tag">マニュアル</span>
          <span class="card-tag">研修</span>
        </div>
      </a>

      <!-- 組織・HR -->
      <a href="category-organization.html" class="category-card pink">
        <div class="card-header">
          <div class="card-icon">
            <i data-lucide="building" style="width:24px;height:24px;"></i>
          </div>
          <div class="card-arrow">
            <i data-lucide="arrow-right" style="width:16px;height:16px;"></i>
          </div>
        </div>
        <div class="card-title">組織・情報</div>
        <div class="card-desc">組織図・バッジ・料金シミュレーターなど</div>
        <div class="card-tags">
          <span class="card-tag">組織図</span>
          <span class="card-tag">バッジ</span>
          <span class="card-tag">数字で見る</span>
        </div>
      </a>

      <!-- リソース・リンク -->
      <a href="category-resources.html" class="category-card teal">
        <div class="card-header">
          <div class="card-icon">
            <i data-lucide="link" style="width:24px;height:24px;"></i>
          </div>
          <div class="card-arrow">
            <i data-lucide="arrow-right" style="width:16px;height:16px;"></i>
          </div>
        </div>
        <div class="card-title">リソース・リンク</div>
        <div class="card-desc">広報素材・公式SNS・各種リンクなど</div>
        <div class="card-tags">
          <span class="card-tag">公式LINE</span>
          <span class="card-tag">SNS</span>
          <span class="card-tag">PV動画</span>
        </div>
      </a>
    </div>

    <!-- 幹部エリア -->
    <div class="executive-section">
      <div class="executive-left">
        <div class="executive-icon">
          <i data-lucide="shield" style="width:26px;height:26px;"></i>
        </div>
        <div class="executive-info">
          <h2>幹部・部署別ページ</h2>
          <p>経理・スケジュール管理・担任など</p>
        </div>
      </div>
      <a href="staff-executive.html" class="executive-btn">
        <i data-lucide="arrow-right" style="width:18px;height:18px;"></i>
        幹部ページへ
      </a>
    </div>
  </main>

  <!-- フッター -->
  <footer class="footer">
    <p class="footer-text">© 2026 EQAO Education Group.</p>
  </footer>

  <script>
    // ===== 初期化 =====
    document.addEventListener('DOMContentLoaded', () => {
      lucide.createIcons();
      checkLoginStatus();
    });

    // ===== ログイン状態チェック =====
    function checkLoginStatus() {
      const session = localStorage.getItem('eqao_staff_session');

      if (!session) {
        // 未ログイン → ログインページへ
        window.location.href = 'login.html';
        return;
      }

      try {
        const data = JSON.parse(session);

        // セッション有効期限チェック
        if (Date.now() > data.expiresAt) {
          localStorage.removeItem('eqao_staff_session');
          window.location.href = 'login.html';
          return;
        }

        // ユーザー情報を表示
        displayUserInfo(data);
      } catch {
        localStorage.removeItem('eqao_staff_session');
        window.location.href = 'login.html';
      }
    }

    // ===== ユーザー情報表示 =====
    function displayUserInfo(data) {
      const name = data.name || data.employeeId || '-';
      const email = data.email || '-';
      const initial = name.charAt(0).toUpperCase();

      document.getElementById('userAvatar').textContent = initial;
      document.getElementById('userName').textContent = name;
      document.getElementById('dropdownName').textContent = name;
      document.getElementById('dropdownEmail').textContent = email;
    }

    // ===== ユーザーメニュー開閉 =====
    function toggleUserMenu() {
      const dropdown = document.getElementById('userDropdown');
      dropdown.classList.toggle('show');
    }

    // メニュー外クリックで閉じる
    document.addEventListener('click', (e) => {
      const userMenu = document.querySelector('.user-menu');
      const dropdown = document.getElementById('userDropdown');

      if (!userMenu.contains(e.target)) {
        dropdown.classList.remove('show');
      }
    });

    // ===== ログアウト =====
    function handleLogout() {
      if (confirm('ログアウトしますか？')) {
        localStorage.removeItem('eqao_staff_session');
        window.location.href = 'login.html';
      }
    }

    // ===== パスワード変更モーダル =====
    function openPasswordModal() {
      document.getElementById('passwordModal').style.display = 'flex';
      document.getElementById('newPassword').value = '';
      document.getElementById('confirmPassword').value = '';
      document.getElementById('passwordError').style.display = 'none';
      document.getElementById('userDropdown').classList.remove('show');
      lucide.createIcons();
    }

    function closePasswordModal() {
      document.getElementById('passwordModal').style.display = 'none';
    }

    // モーダル外クリックで閉じる
    document.getElementById('passwordModal')?.addEventListener('click', function (e) {
      if (e.target === this) closePasswordModal();
    });

    async function changePassword() {
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const errorEl = document.getElementById('passwordError');

      // バリデーション
      if (newPassword.length < 8) {
        errorEl.textContent = 'パスワードは8文字以上で入力してください';
        errorEl.style.display = 'block';
        return;
      }

      if (newPassword !== confirmPassword) {
        errorEl.textContent = 'パスワードが一致しません';
        errorEl.style.display = 'block';
        return;
      }

      // セッションから従業員番号を取得
      const session = JSON.parse(localStorage.getItem('eqao_staff_session') || '{}');
      const employeeId = session.employeeId;

      if (!employeeId) {
        alert('ログイン情報が取得できません。再ログインしてください。');
        window.location.href = 'login.html';
        return;
      }

      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbyFJMfjgZzOw9v16PEoQQrRqqYe__oSn6zHdajEXdeXaUf6ACxwBhcMaGf449Qju-t-/exec', {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain' },
          body: JSON.stringify({
            action: 'changePassword',
            employeeId: employeeId,
            newPassword: newPassword
          })
        });

        const result = await response.json();

        if (result.success) {
          alert('パスワードを変更しました');
          closePasswordModal();
        } else {
          errorEl.textContent = result.message || 'エラーが発生しました';
          errorEl.style.display = 'block';
        }
      } catch (e) {
        errorEl.textContent = '通信エラーが発生しました';
        errorEl.style.display = 'block';
      }
    }

  </script>

  <!-- パスワード変更モーダル -->
  <div id="passwordModal" class="modal-overlay" style="display:none;">
    <div class="modal-container">
      <div class="modal-header">
        <h3 class="modal-title">パスワード変更</h3>
        <button class="modal-close" onclick="closePasswordModal()">
          <i data-lucide="x" style="width:20px;height:20px;"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">新しいパスワード</label>
          <input type="password" id="newPassword" class="form-input" placeholder="8文字以上で入力">
        </div>
        <div class="form-group">
          <label class="form-label">パスワード確認</label>
          <input type="password" id="confirmPassword" class="form-input" placeholder="もう一度入力">
        </div>
        <p id="passwordError" class="error-message" style="display:none;"></p>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" onclick="closePasswordModal()">キャンセル</button>
        <button class="btn-primary" onclick="changePassword()">変更する</button>
      </div>
    </div>
  </div>

</body>

</html>